<script src="js/handlebars.min.js"></script>
<script id="search-results-template" type="text/x-handlebars-template">
  <div class="row num-results-container">
    {{#if numPosts}}
      <span id="num-results">{{numPosts}} results | <a href="https://www.reddit.com/submit?url={{url}}&resubmit=true">repost to Reddit</a></span>
    {{else}}
      <span id="num-results">{{numPosts}} results | <a href="https://www.reddit.com/submit?url={{url}}">post to Reddit</a></span>
    {{/if}}
  </div>
  <div class="row container-fluid list-container">
    <table id="list" class="table">
      {{#each posts}}
        <tr class="row">
          <td class="col-md-2 score">
            {{data.score}}
          </td>
          <td class="col-md-8 title">
              <span>
                <a href="https://www.reddit.com{{data.permalink}}">
                  <span class="post-title">{{data.title}}</span>
                </a>
                <br/>
                <a href="https://www.reddit.com{{data.permalink}}">
                  <span class="num-comments">{{data.num_comments}} comments | </span>
                </a>
                <small class="post-details">
                  submitted {{data.age}} ago by 
                  <a href="https://www.reddit.com/u/{{data.author}}">/u/{{data.author}}</a>
                </small>
                <br/>
              </span>
          </td>
          <td class="col-md-2 subreddit">
            <a href="https://www.reddit.com/r/{{data.subreddit}}">/r/{{data.subreddit}}</a>
          </td>
        </tr>
      {{/each}}
    </table>
  </div>
</script>

<script>
  var template = Handlebars.compile(document.getElementById("search-results-template").innerHTML);
  window.addEventListener('message', function(event) {
    event.source.postMessage({
      html: template(event.data.context)
    }, event.origin);
  });
</script>
